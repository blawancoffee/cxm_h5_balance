(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[20],{RXBc:function(e,t,a){"use strict";var l=a("TqRt"),n=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("P2fV");var i=l(a("NJEC"));a("Mwp2");var r=l(a("VXEj")),d=l(a("pVnL"));a("14J3");var u=l(a("BMrR"));a("Telt");var s=l(a("Tckk"));a("+L6B");var c=l(a("2/Rp"));a("jCWc");var f=l(a("kPKH"));a("miYZ");var o=l(a("tsqr")),p=l(a("lwsE")),m=l(a("W8MJ")),h=l(a("a1gu")),y=l(a("Nsbk")),E=l(a("7W2i"));a("5NDa");var g=l(a("5rEg"));a("2qtc");var v=l(a("kLXV"));a("IzEo");var b=l(a("bx4M"));a("FJo9");var I=l(a("L41K"));a("OaEy");var k=l(a("2fM7"));a("g9YV");var S=l(a("wCAj"));a("y8nQ");var _,x,D,C=l(a("Vl3Y")),w=n(a("q1tI")),A=l(a("wd/R")),O=a("MuoO"),L=l(a("usdK")),F=l(a("XfOM")),N=a("RO9D"),B=a("7cBs"),T=l(a("LtKH")),q=l(a("JU94")),M=l(a("QdJ6")),J=l(a("XoQv")),j=C.default.Item,z=S.default.Column,V=k.default.Option,Y=I.default.Step,Q=b.default.Meta,R=v.default.confirm,X=g.default.TextArea,G=(_=(0,O.connect)(function(e){var t=e.login,a=e.loading;return{login:t,loading:a.models.list}}),x=C.default.create(),_(D=x(D=function(e){function t(e){var a;return(0,p.default)(this,t),a=(0,h.default)(this,(0,y.default)(t).call(this,e)),a.settlement=function(){""!==a.state.supplierId&&""!==a.state.batchId?(0==a.state.totalSpending&&0==a.state.totalInComing&&o.default.info("\u662f\u5426\u4e0d\u5f55\u5165\u5176\u4ed6\u8d39\u7528!"),a.fetchAccount({suppliId:a.state.supplierId})):o.default.info("\u8d27\u4e3b\u8f66\u6b21\u4e0d\u53ef\u4e3a\u7a7a!")},a.handleOnQuery=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var l=t.supplierId,n=t.batchId;(0,N.isEmptyObject)(l)?o.default.warn("\u8bf7\u9009\u62e9\u8d27\u4e3b"):(0,N.isEmptyObject)(n)?o.default.warn("\u8bf7\u9009\u62e9\u8f66\u6b21"):(a.setState({supplierId:l,batchId:n,loading:!0}),a.fetchStatistical({supplierId:l,batchId:n}))}})},a.add=function(){a.fetchFinanceList({supplierId:a.state.supplierId,batchId:a.state.batchId}),a.setState({show:!0})},a.handleCancel=function(){a.setState({show:!1}),a.fetchStatistical({supplierId:a.state.supplierId,batchId:a.state.batchId})},a.modifyStatusBtn=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var l=t.name,n=t.type,i=t.amount,r=t.remark;(0,N.isEmptyObject)(l)?o.default.warn("\u8bf7\u9009\u62e9\u6536\u652f\u7c7b\u578b"):(0,N.isEmptyObject)(n)?o.default.warn("\u8bf7\u9009\u62e9\u8d26\u76ee\u7c7b\u578b"):(0,N.isEmptyObject)(i)?o.default.warn("\u8bf7\u8f93\u5165\u91d1\u989d"):i>1e7?o.default.error("\u91d1\u989d\u6570\u503c\u4e0d\u53ef\u5927\u4e8e999999.99!"):a.fetchFinanceEntry({type:l,value:n.split("|")[0],code:n.split("|")[1],amount:i,remark:r,supplierId:a.state.supplierId,batchId:a.state.batchId})}})},a.state={show:!1,supplierId:"",batchId:"",step:0,disabled:!0,totalSpending:0,totalInComing:0,loading:!1},a}return(0,E.default)(t,e),(0,m.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=localStorage.getItem("loginStatus");t?this.fetchSupplierList({}):setTimeout(function(){e.fetchSupplierList({})},3e3)}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"login/clearData",payload:{}})}},{key:"getExtraContent",value:function(){var e=this.props.login,t=e.supplierListData,a=e.batchSallOutListData,l=e.statisticalData,n=this.props.form.getFieldDecorator,i=t&&!Array.isArray(t)?t.suppliers:[],r=a||[],d=l&&!Array.isArray(l)?l:[],o=d.totalSpending,p=d.goodsPayment,m=d.totalInComing,h=d.totalGoodsAmount;h=h||"0",o=o||"0",p=p||"0",m=m||"0";var y={xs:24,sm:12,md:12,lg:12,xl:6,style:{marginBottom:12}};return w.default.createElement("div",{className:F.default.extraContent},w.default.createElement(C.default,{onSubmit:this.handleOnQuery,className:"login-form"},w.default.createElement(u.default,{gutter:24},w.default.createElement(f.default,y,w.default.createElement(j,null,n("supplierId",{})(w.default.createElement(k.default,{placeholder:"\u8bf7\u9009\u62e9\u8d27\u4e3b",onChange:this.selectSupplier.bind(this),showSearch:!0,allowClear:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},i.map(function(e){return w.default.createElement(V,{key:e.user_id},e.name)}))))),w.default.createElement(f.default,y,w.default.createElement(j,null,n("batchId",{})(w.default.createElement(k.default,{placeholder:"\u8bf7\u9009\u62e9\u8f66\u6b21\u4fe1\u606f",onChange:this.selectBatch.bind(this)},r.map(function(e){return w.default.createElement(k.default.Option,{key:e.id},e.carNo)}))))),w.default.createElement(f.default,{span:24,className:F.default.submitBtn},w.default.createElement(c.default,{type:"primary",htmlType:"submit",disabled:this.state.disabled},"\u67e5\u8be2"),w.default.createElement(c.default,{onClick:this.add,disabled:this.state.disabled,style:{width:160}},"\u8d27\u4e3b\u8d39\u7528\u652f\u51fa\u4e0e\u6536\u5165"),w.default.createElement(c.default,{onClick:this.settlement,disabled:this.state.disabled},"\u7ed3\u7b97")),w.default.createElement(f.default,{span:24},w.default.createElement(I.default,{current:this.state.step,className:F.default.step,style:{margin:"20px 0",display:"flex"}},w.default.createElement(Y,{style:{flex:1,textAlign:"left"},title:"\u6b65\u9aa4\u4e00",description:"\u9009\u62e9\u9700\u8981\u7ed3\u7b97\u7684\u8f66\u6b21"}),w.default.createElement(Y,{style:{flex:1,textAlign:"left"},title:"\u6b65\u9aa4\u4e8c",description:"\u5f55\u5165\u8f66\u6b21\u652f\u51fa\u8d39\u7528"}),w.default.createElement(Y,{style:{flex:1,textAlign:"left"},title:"\u6b65\u9aa4\u4e09",description:"\u7ed3\u7b97\u5e76\u6253\u5370"}))),w.default.createElement(f.default,y,w.default.createElement(b.default,null,w.default.createElement(Q,{avatar:w.default.createElement(s.default,{shape:"square",size:60,src:T.default}),title:"\u8d27\u6b3e\u91d1\u989d",description:h,style:{fontSize:20}}))),w.default.createElement(f.default,y,w.default.createElement(b.default,null,w.default.createElement(Q,{avatar:w.default.createElement(s.default,{shape:"square",size:60,src:q.default}),title:"\u652f\u51fa\u5408\u8ba1",description:o,style:{fontSize:20}}))),w.default.createElement(f.default,y,w.default.createElement(b.default,null,w.default.createElement(Q,{avatar:w.default.createElement(s.default,{shape:"square",size:60,src:M.default}),title:"\u6536\u5165\u5408\u8ba1",description:m,style:{fontSize:20}}))),w.default.createElement(f.default,y,w.default.createElement(b.default,null,w.default.createElement(Q,{avatar:w.default.createElement(s.default,{shape:"square",size:60,src:J.default}),title:"\u5e94\u7ed3\u8d27\u6b3e",description:p,style:{fontSize:20}}))))))}},{key:"fetchStatistical",value:function(e){var t=this;return this.props.dispatch({type:"login/fetchStatistical",payload:e}).then(function(){var e=t.props.login.statisticalData,a=e||[],l=a.totalSpending,n=a.totalInComing;t.setState({totalSpending:l,totalInComing:n,loading:!1})})}},{key:"fetchSupplierList",value:function(e){console.log("index",e,(new Date).getTime()),this.props.dispatch({type:"login/fetchSupplierList",payload:e})}},{key:"fetchBatchSallOutList",value:function(e){this.props.dispatch({type:"login/fetchBatchSallOutList",payload:e})}},{key:"fetchFinanceEntry",value:function(e){var t=this;this.props.dispatch({type:"login/fetchFinanceEntry",payload:e}).then(function(){var e=t.props.login.financeEntrylData.code;200===e?(o.default.info("\u65b0\u589e\u8d26\u76ee\u7c7b\u578b\u6210\u529f!"),t.fetchFinanceList({supplierId:t.state.supplierId,batchId:t.state.batchId}),t.setState({step:1})):o.default.info("\u65b0\u589e\u8d26\u76ee\u7c7b\u578b\u5931\u8d25!")})}},{key:"selectDicData",value:function(e){this.fetchDicData({name:e,dictType:"accountsAct"})}},{key:"fetchDicData",value:function(e){this.props.dispatch({type:"login/fetchDicData",payload:e})}},{key:"fetchFinanceList",value:function(e){this.props.dispatch({type:"login/fetchFinanceList",payload:e})}},{key:"fetchFinanceDelete",value:function(e){var t=this;this.props.dispatch({type:"login/fetchFinanceDelete",payload:e}).then(function(){var e=t.props.login.financeDeleteData.code;200===e?(o.default.info("\u5220\u9664\u6210\u529f!"),t.fetchFinanceList({supplierId:t.state.supplierId,batchId:t.state.batchId})):o.default.info("\u5220\u9664\u5931\u8d25!")})}},{key:"fetchSettmentGoods",value:function(e){var t=this;this.props.dispatch({type:"login/fetchSettmentGoods",payload:e}).then(function(){var e=t.props.login.settmentGoodsData,a=e.code,l=e.data;200===a?L.default.push("/funds/paymentbill?id=".concat(l)):o.default.error("\u7ed3\u7b97\u5931\u8d25")})}},{key:"fetchAccount",value:function(e){var t=this;this.props.dispatch({type:"login/fetchAccount",payload:e}).then(function(){var e=t.props.login.accountData,a=t;e?a.fetchSettmentGoods({supplierId:a.state.supplierId,batchId:a.state.batchId,accountId:e}):R({title:"\u8be5\u8d27\u4e3b\u672a\u5f00\u901a\u7ed3\u7b97\u8d26\u6237\uff0c\u662f\u5426\u7ee7\u7eed\u7ed3\u7b97?",content:"",onOk:function(){a.fetchSettmentGoods({supplierId:a.state.supplierId,batchId:a.state.batchId})},onCancel:function(){return!1}})})}},{key:"selectSupplier",value:function(e){if(!e)return!1;this.setState({supplierId:e}),this.fetchBatchSallOutList({supplierId:e,settlement:0})}},{key:"selectBatch",value:function(e){this.setState({batchId:e,disabled:!1})}},{key:"delete",value:function(e){this.fetchFinanceDelete({id:e})}},{key:"render",value:function(){var e=this,t=this.props.login,a=t.statisticalData,l=t.dicData,n=t.financeListData,s=this.props.form.getFieldDecorator,o=this.getExtraContent(),p={pageSize:10},m=a&&!Array.isArray(a)?a:[],h=m.goodsVos;Array.isArray(h)||(h=[]);var y=Array.isArray(l)?l:[],E=[];if(n&&!Array.isArray(n)){var I=n.cxmBatchFinances,_=n.totalAmount,x={createTime:"\u5408\u8ba1",amount:_,id:-1},D=I.length;D&&JSON.stringify(I[D-1])!==JSON.stringify(x)&&I.push(x),E=I}var O={labelCol:{xs:{span:4},sm:{span:4}},wrapperCol:{xs:{span:20},sm:{span:20}}},L=w.default.createElement("div",null,w.default.createElement(C.default,{onSubmit:this.modifyStatusBtn,className:"login-form",style:{marginBottom:"12px",float:"left",width:"100%"}},w.default.createElement(u.default,{gutter:24},w.default.createElement(f.default,{span:12},w.default.createElement(j,(0,d.default)({label:"\u6536\u652f\u7c7b\u578b"},O),s("name",{rules:[{required:!1,message:"\u8bf7\u9009\u62e9\u6536\u652f\u7c7b\u578b!"}]})(w.default.createElement(k.default,{placeholder:"\u8bf7\u9009\u62e9\u6536\u652f\u7c7b\u578b",style:{width:"100%"},onChange:this.selectDicData.bind(this)},w.default.createElement(V,{value:"\u6536\u5165"},"\u6536\u5165"),w.default.createElement(V,{value:"\u652f\u51fa"},"\u652f\u51fa"))))),w.default.createElement(f.default,{span:12},w.default.createElement(j,(0,d.default)({label:"\u8d26\u76ee\u7c7b\u578b"},O),s("type",{rules:[{required:!1,message:"\u8bf7\u9009\u62e9\u8d26\u76ee\u7c7b\u578b!"}]})(w.default.createElement(k.default,{placeholder:"\u8bf7\u9009\u62e9\u8d26\u76ee\u7c7b\u578b",style:{width:"100%"}},y.map(function(e){return w.default.createElement(V,{key:"".concat(e.value,"|").concat(e.code)},e.value)})))))),w.default.createElement(u.default,{gutter:24},w.default.createElement(f.default,{span:12},w.default.createElement(j,(0,d.default)({label:"\u91d1\u989d"},O),s("amount",{rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u91d1\u989d!"}]})(w.default.createElement(g.default,{placeholder:"\u8bf7\u8f93\u5165\u91d1\u989d"})))),w.default.createElement(f.default,{span:12},w.default.createElement(j,(0,d.default)({label:"\u5907\u6ce8"},O),s("remark",{rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u5907\u6ce8!"}]})(w.default.createElement(X,{rows:2,placeholder:"\u8bf7\u8f93\u5165\u5907\u6ce8"}))))),w.default.createElement(u.default,{gutter:24},w.default.createElement(f.default,{span:24},w.default.createElement(c.default,null,"\u67e5\u8be2"),w.default.createElement(c.default,{type:"primary",htmlType:"submit"},"\u4fdd\u5b58")))));return w.default.createElement("div",{className:F.default.billDetails},w.default.createElement(b.default,{className:F.default.listCard,bordered:!1,title:"",extra:o},w.default.createElement(S.default,{dataSource:h,pagination:p,scroll:{x:800},bordered:!0,loading:this.state.loading},w.default.createElement(z,{title:"\u54c1\u79cd",dataIndex:"attrName",key:"attrName"}),w.default.createElement(z,{title:"\u9500\u552e\u8d27\u6b3e",dataIndex:"goodsAmount",key:"goodsAmount",render:function(e,t){var a=t.goodsAmount;return w.default.createElement("span",null,(0,B.Yuan)(a,2))}}),w.default.createElement(z,{title:"\u4ef6\u6570",dataIndex:"number",key:"number"}),w.default.createElement(z,{title:"\u91cd\u91cf",dataIndex:"weight",key:"weight"}),w.default.createElement(z,{title:"\u5e73\u5747\u552e\u4ef7",dataIndex:"averageAmount",key:"averageAmount",render:function(e,t){var a=t.averageAmount;return w.default.createElement("span",null,(0,B.Yuan)(a,2))}}),w.default.createElement(z,{title:"\u5e73\u5747\u91cd\u91cf",dataIndex:"averageWeight",key:"averageWeight"}))),w.default.createElement(b.default,{className:F.default.modalCard},w.default.createElement(v.default,{title:"\u8d27\u4e3b\u8d39\u7528\u652f\u51fa\u4e0e\u6536\u5165",visible:this.state.show,onCancel:this.handleCancel,destroyOnClose:"true",width:"1200px",className:F.default.modal,footer:[]},w.default.createElement(r.default,null,L),w.default.createElement(S.default,{dataSource:E,pagination:p,scroll:{x:600}},w.default.createElement(z,{title:"\u65f6\u95f4",dataIndex:"createTime",key:"createTime",render:function(e,t){var a=t.createTime;return w.default.createElement("span",null,"\u5408\u8ba1"!==a?(0,A.default)(a).format("YYYY-MM-DD HH:mm"):"\u5408\u8ba1")}}),w.default.createElement(z,{title:"\u6536\u652f\u7c7b\u578b",dataIndex:"type",key:"type"}),w.default.createElement(z,{title:"\u8d26\u76ee\u7c7b\u578b",dataIndex:"value",key:"value"}),w.default.createElement(z,{title:"\u64cd\u4f5c\u4eba",dataIndex:"createName",key:"createName"}),w.default.createElement(z,{title:"\u91d1\u989d",dataIndex:"amount",key:"amount",render:function(e,t){var a=t.amount;return w.default.createElement("span",null,(0,B.Yuan)(a,2))}}),w.default.createElement(z,{title:"\u5907\u6ce8",dataIndex:"remark",key:"remark"}),w.default.createElement(z,{title:"\u64cd\u4f5c",dataIndex:"operating",key:"operating",render:function(t,a){var l=a.id;return w.default.createElement(i.default,{title:"\u662f\u5426\u5220\u9664\u652f\u51fa\u8d39\u7528\u6570\u636e",onConfirm:e.delete.bind(e,l),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},w.default.createElement("a",{href:"javascript:;"},l>0?"\u5220\u9664":""))}})))))}}]),t}(w.PureComponent))||D)||D),K=G;t.default=K},XfOM:function(e,t,a){e.exports={billDetails:"billDetails___3sOVa",title:"title___2cyli",listCard:"listCard___2KEKC",cashFlowTitle:"cashFlowTitle___3mJ74",extraContent:"extraContent___1FsEV",submitBtn:"submitBtn___1VtyC",salesDataQuery:"salesDataQuery___3e0Uy",timeSelection:"timeSelection___1GstR",select:"select___3_BCq",paymentbill:"paymentbill___3n1O1",header:"header___2ZAQi",btn:"btn___-RH0X",name:"name___Z4CkU",left:"left___11s8X"}}}]);