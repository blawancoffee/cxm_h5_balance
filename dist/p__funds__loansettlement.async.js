(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{JmTs:function(e,t,a){"use strict";var l=a("TqRt"),n=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("P2fV");var d=l(a("NJEC"));a("Mwp2");var i=l(a("VXEj")),r=l(a("pVnL")),u=l(a("MVZn"));a("14J3");var c=l(a("BMrR"));a("Telt");var s=l(a("Tckk"));a("+L6B");var f=l(a("2/Rp"));a("jCWc");var o=l(a("kPKH"));a("miYZ");var p=l(a("tsqr")),m=l(a("lwsE")),h=l(a("W8MJ")),y=l(a("a1gu")),E=l(a("Nsbk")),v=l(a("7W2i"));a("5NDa");var g=l(a("5rEg"));a("2qtc");var I=l(a("kLXV"));a("IzEo");var b=l(a("bx4M"));a("FJo9");var k=l(a("L41K"));a("OaEy");var S=l(a("2fM7"));a("g9YV");var x=l(a("wCAj"));a("y8nQ");var D,w=l(a("Vl3Y")),A=n(a("q1tI")),C=l(a("wd/R")),L=a("MuoO"),O=l(a("usdK")),N=l(a("xLbA")),F=a("RO9D"),T=a("7cBs"),B=l(a("LtKH")),q=l(a("JU94")),M=l(a("QdJ6")),J=l(a("XoQv")),j=w.default.Item,z=x.default.Column,Y=S.default.Option,V=k.default.Step,G=b.default.Meta,W=I.default.confirm,P=g.default.TextArea,Q=(0,L.connect)(function(e){return{finance:e.finance,loading:e.loading.models.list}})(D=w.default.create()(D=function(e){function t(e){var a;return(0,m.default)(this,t),(a=(0,y.default)(this,(0,E.default)(t).call(this,e))).settlement=function(){""!==a.state.supplierId&&""!==a.state.batchId?(0==a.state.totalSpending&&0==a.state.totalInComing&&p.default.info("\u662f\u5426\u4e0d\u5f55\u5165\u5176\u4ed6\u8d39\u7528!"),a.fetchAccount({suppliId:a.state.supplierId})):p.default.info("\u8d27\u4e3b\u8f66\u6b21\u4e0d\u53ef\u4e3a\u7a7a!")},a.handleOnQuery=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var l=t.supplierId,n=t.batchId;(0,F.isEmptyObject)(l)?p.default.warn("\u8bf7\u9009\u62e9\u8d27\u4e3b"):(0,F.isEmptyObject)(n)?p.default.warn("\u8bf7\u9009\u62e9\u8f66\u6b21"):(a.setState({supplierId:l,batchId:n,loading:!0}),a.fetchStatistical({supplierId:l,batchId:n}))}})},a.add=function(){a.fetchFinanceList({supplierId:a.state.supplierId,batchId:a.state.batchId}),a.setState({show:!0})},a.handleCancel=function(){a.setState({show:!1}),a.fetchStatistical({supplierId:a.state.supplierId,batchId:a.state.batchId})},a.modifyStatusBtn=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var l=t.name,n=t.type,d=t.amount,i=t.remark;(0,F.isEmptyObject)(l)?p.default.warn("\u8bf7\u9009\u62e9\u6536\u652f\u7c7b\u578b"):(0,F.isEmptyObject)(n)?p.default.warn("\u8bf7\u9009\u62e9\u8d26\u76ee\u7c7b\u578b"):(0,F.isEmptyObject)(d)?p.default.warn("\u8bf7\u8f93\u5165\u91d1\u989d"):1e7<d?p.default.error("\u91d1\u989d\u6570\u503c\u4e0d\u53ef\u5927\u4e8e999999.99!"):a.fetchFinanceEntry({type:l,value:n.split("|")[0],code:n.split("|")[1],amount:d,remark:i,supplierId:a.state.supplierId,batchId:a.state.batchId})}})},a.state={show:!1,supplierId:"",batchId:"",step:0,disabled:!0,totalSpending:0,totalInComing:0,loading:!1},a}return(0,v.default)(t,e),(0,h.default)(t,[{key:"componentDidMount",value:function(){this.fetchSupplierList({})}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"finance/clearData",payload:{}})}},{key:"getExtraContent",value:function(){var e=this.props.finance,t=e.supplierListData,a=e.batchSallOutListData,l=e.statisticalData,n=this.props.form.getFieldDecorator,d=t&&!Array.isArray(t)?t.suppliers:[],i=a||[],r=l&&!Array.isArray(l)?l:[],u=r.totalSpending,p=r.goodsPayment,m=r.totalInComing,h=r.totalGoodsAmount;h=h||"0",u=u||"0",p=p||"0",m=m||"0";var y={xs:24,sm:12,md:12,lg:12,xl:6,style:{marginBottom:12}};return A.default.createElement("div",{className:N.default.extraContent},A.default.createElement(w.default,{onSubmit:this.handleOnQuery,className:"login-form"},A.default.createElement(c.default,{gutter:24},A.default.createElement(o.default,y,A.default.createElement(j,null,n("supplierId",{})(A.default.createElement(S.default,{placeholder:"\u8bf7\u9009\u62e9\u8d27\u4e3b",onChange:this.selectSupplier.bind(this),showSearch:!0,allowClear:!0,filterOption:function(e,t){return 0<=t.props.children.toLowerCase().indexOf(e.toLowerCase())}},d.map(function(e){return A.default.createElement(Y,{key:e.user_id},e.name)}))))),A.default.createElement(o.default,y,A.default.createElement(j,null,n("batchId",{})(A.default.createElement(S.default,{placeholder:"\u8bf7\u9009\u62e9\u8f66\u6b21\u4fe1\u606f",onChange:this.selectBatch.bind(this)},i.map(function(e){return A.default.createElement(S.default.Option,{key:e.id},e.carNo)}))))),A.default.createElement(o.default,{span:24,className:N.default.submitBtn},A.default.createElement(f.default,{type:"primary",htmlType:"submit",disabled:this.state.disabled},"\u67e5\u8be2"),A.default.createElement(f.default,{onClick:this.add,disabled:this.state.disabled,style:{width:160}},"\u8d27\u4e3b\u8d39\u7528\u652f\u51fa\u4e0e\u6536\u5165"),A.default.createElement(f.default,{onClick:this.settlement,disabled:this.state.disabled},"\u7ed3\u7b97")),A.default.createElement(o.default,{span:24},A.default.createElement(k.default,{current:this.state.step,className:N.default.step,style:{margin:"20px 0",display:"flex"}},A.default.createElement(V,{style:{flex:1,textAlign:"left"},title:"\u6b65\u9aa4\u4e00",description:"\u9009\u62e9\u9700\u8981\u7ed3\u7b97\u7684\u8f66\u6b21"}),A.default.createElement(V,{style:{flex:1,textAlign:"left"},title:"\u6b65\u9aa4\u4e8c",description:"\u5f55\u5165\u8f66\u6b21\u652f\u51fa\u8d39\u7528"}),A.default.createElement(V,{style:{flex:1,textAlign:"left"},title:"\u6b65\u9aa4\u4e09",description:"\u7ed3\u7b97\u5e76\u6253\u5370"}))),A.default.createElement(o.default,y,A.default.createElement(b.default,null,A.default.createElement(G,{avatar:A.default.createElement(s.default,{shape:"square",size:60,src:B.default}),title:"\u8d27\u6b3e\u91d1\u989d",description:h,style:{fontSize:20}}))),A.default.createElement(o.default,y,A.default.createElement(b.default,null,A.default.createElement(G,{avatar:A.default.createElement(s.default,{shape:"square",size:60,src:q.default}),title:"\u652f\u51fa\u5408\u8ba1",description:u,style:{fontSize:20}}))),A.default.createElement(o.default,y,A.default.createElement(b.default,null,A.default.createElement(G,{avatar:A.default.createElement(s.default,{shape:"square",size:60,src:M.default}),title:"\u6536\u5165\u5408\u8ba1",description:m,style:{fontSize:20}}))),A.default.createElement(o.default,y,A.default.createElement(b.default,null,A.default.createElement(G,{avatar:A.default.createElement(s.default,{shape:"square",size:60,src:J.default}),title:"\u5e94\u7ed3\u8d27\u6b3e",description:p,style:{fontSize:20}}))))))}},{key:"androidLogin",value:function(e){var t=this,a={accessToken:e,appType:"android"};this.props.dispatch({type:"login/bindAndroid",payload:(0,u.default)({},a)}).then(function(e){t.fetchSupplierList({})})}},{key:"fetchStatistical",value:function(e){var t=this;return this.props.dispatch({type:"finance/fetchStatistical",payload:e}).then(function(){var e=t.props.finance.statisticalData||[],a=e.totalSpending,l=e.totalInComing;t.setState({totalSpending:a,totalInComing:l,loading:!1})})}},{key:"fetchSupplierList",value:function(e){this.props.dispatch({type:"finance/fetchSupplierList",payload:e})}},{key:"fetchBatchSallOutList",value:function(e){this.props.dispatch({type:"finance/fetchBatchSallOutList",payload:e})}},{key:"fetchFinanceEntry",value:function(e){var t=this;this.props.dispatch({type:"finance/fetchFinanceEntry",payload:e}).then(function(){200===t.props.finance.financeEntrylData.code?(p.default.info("\u65b0\u589e\u8d26\u76ee\u7c7b\u578b\u6210\u529f!"),t.fetchFinanceList({supplierId:t.state.supplierId,batchId:t.state.batchId}),t.setState({step:1})):p.default.info("\u65b0\u589e\u8d26\u76ee\u7c7b\u578b\u5931\u8d25!")})}},{key:"selectDicData",value:function(e){this.fetchDicData({name:e,dictType:"accountsAct"})}},{key:"fetchDicData",value:function(e){this.props.dispatch({type:"finance/fetchDicData",payload:e})}},{key:"fetchFinanceList",value:function(e){this.props.dispatch({type:"finance/fetchFinanceList",payload:e})}},{key:"fetchFinanceDelete",value:function(e){var t=this;this.props.dispatch({type:"finance/fetchFinanceDelete",payload:e}).then(function(){200===t.props.finance.financeDeleteData.code?(p.default.info("\u5220\u9664\u6210\u529f!"),t.fetchFinanceList({supplierId:t.state.supplierId,batchId:t.state.batchId})):p.default.info("\u5220\u9664\u5931\u8d25!")})}},{key:"fetchSettmentGoods",value:function(e){var t=this;this.props.dispatch({type:"finance/fetchSettmentGoods",payload:e}).then(function(){var e=t.props.finance.settmentGoodsData,a=e.code,l=e.data;200===a?O.default.push("/funds/paymentbill?id=".concat(l)):p.default.error("\u7ed3\u7b97\u5931\u8d25")})}},{key:"fetchAccount",value:function(e){var t=this;this.props.dispatch({type:"finance/fetchAccount",payload:e}).then(function(){var e=t.props.finance.accountData,a=t;e?a.fetchSettmentGoods({supplierId:a.state.supplierId,batchId:a.state.batchId,accountId:e}):W({title:"\u8be5\u8d27\u4e3b\u672a\u5f00\u901a\u7ed3\u7b97\u8d26\u6237\uff0c\u662f\u5426\u7ee7\u7eed\u7ed3\u7b97?",content:"",onOk:function(){a.fetchSettmentGoods({supplierId:a.state.supplierId,batchId:a.state.batchId})},onCancel:function(){return!1}})})}},{key:"selectSupplier",value:function(e){this.setState({supplierId:e}),this.fetchBatchSallOutList({supplierId:e,settlement:0})}},{key:"selectBatch",value:function(e){this.setState({batchId:e,disabled:!1})}},{key:"delete",value:function(e){this.fetchFinanceDelete({id:e})}},{key:"render",value:function(){var e=this,t=this.props.finance,a=t.statisticalData,l=t.dicData,n=t.financeListData,u=this.props.form.getFieldDecorator,s=this.getExtraContent(),p={pageSize:10},m=(a&&!Array.isArray(a)?a:[]).goodsVos;Array.isArray(m)||(m=[]);var h=Array.isArray(l)?l:[],y=[];if(n&&!Array.isArray(n)){var E=n.cxmBatchFinances,v={createTime:"\u5408\u8ba1",amount:n.totalAmount,id:-1},k=E.length;k&&JSON.stringify(E[k-1])!==JSON.stringify(v)&&E.push(v),y=E}var D={labelCol:{xs:{span:4},sm:{span:4}},wrapperCol:{xs:{span:20},sm:{span:20}}},L=A.default.createElement("div",null,A.default.createElement(w.default,{onSubmit:this.modifyStatusBtn,className:"login-form",style:{marginBottom:"12px",float:"left",width:"100%"}},A.default.createElement(c.default,{gutter:24},A.default.createElement(o.default,{span:12},A.default.createElement(j,(0,r.default)({label:"\u6536\u652f\u7c7b\u578b"},D),u("name",{rules:[{required:!1,message:"\u8bf7\u9009\u62e9\u6536\u652f\u7c7b\u578b!"}]})(A.default.createElement(S.default,{placeholder:"\u8bf7\u9009\u62e9\u6536\u652f\u7c7b\u578b",style:{width:"100%"},onChange:this.selectDicData.bind(this)},A.default.createElement(Y,{value:"\u6536\u5165"},"\u6536\u5165"),A.default.createElement(Y,{value:"\u652f\u51fa"},"\u652f\u51fa"))))),A.default.createElement(o.default,{span:12},A.default.createElement(j,(0,r.default)({label:"\u8d26\u76ee\u7c7b\u578b"},D),u("type",{rules:[{required:!1,message:"\u8bf7\u9009\u62e9\u8d26\u76ee\u7c7b\u578b!"}]})(A.default.createElement(S.default,{placeholder:"\u8bf7\u9009\u62e9\u8d26\u76ee\u7c7b\u578b",style:{width:"100%"}},h.map(function(e){return A.default.createElement(Y,{key:"".concat(e.value,"|").concat(e.code)},e.value)})))))),A.default.createElement(c.default,{gutter:24},A.default.createElement(o.default,{span:12},A.default.createElement(j,(0,r.default)({label:"\u91d1\u989d"},D),u("amount",{rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u91d1\u989d!"}]})(A.default.createElement(g.default,{placeholder:"\u8bf7\u8f93\u5165\u91d1\u989d"})))),A.default.createElement(o.default,{span:12},A.default.createElement(j,(0,r.default)({label:"\u5907\u6ce8"},D),u("remark",{rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u5907\u6ce8!"}]})(A.default.createElement(P,{rows:2,placeholder:"\u8bf7\u8f93\u5165\u5907\u6ce8"}))))),A.default.createElement(c.default,{gutter:24},A.default.createElement(o.default,{span:24},A.default.createElement(f.default,null,"\u67e5\u8be2"),A.default.createElement(f.default,{type:"primary",htmlType:"submit"},"\u4fdd\u5b58")))));return A.default.createElement("div",null,A.default.createElement("div",{className:N.default.billDetails},A.default.createElement(b.default,{className:N.default.listCard,bordered:!1,title:"",extra:s},A.default.createElement(x.default,{dataSource:m,pagination:p,scroll:{x:800},bordered:!0,loading:this.state.loading},A.default.createElement(z,{title:"\u54c1\u79cd",dataIndex:"attrName",key:"attrName"}),A.default.createElement(z,{title:"\u9500\u552e\u8d27\u6b3e",dataIndex:"goodsAmount",key:"goodsAmount",render:function(e,t){var a=t.goodsAmount;return A.default.createElement("span",null,(0,T.Yuan)(a,2))}}),A.default.createElement(z,{title:"\u4ef6\u6570",dataIndex:"number",key:"number"}),A.default.createElement(z,{title:"\u91cd\u91cf",dataIndex:"weight",key:"weight"}),A.default.createElement(z,{title:"\u5e73\u5747\u552e\u4ef7",dataIndex:"averageAmount",key:"averageAmount",render:function(e,t){var a=t.averageAmount;return A.default.createElement("span",null,(0,T.Yuan)(a,2))}}),A.default.createElement(z,{title:"\u5e73\u5747\u91cd\u91cf",dataIndex:"averageWeight",key:"averageWeight"}))),A.default.createElement(b.default,{className:N.default.modalCard},A.default.createElement(I.default,{title:"\u8d27\u4e3b\u8d39\u7528\u652f\u51fa\u4e0e\u6536\u5165",visible:this.state.show,onCancel:this.handleCancel,destroyOnClose:"true",width:"1200px",className:N.default.modal,footer:[]},A.default.createElement(i.default,null,L),A.default.createElement(x.default,{dataSource:y,pagination:p,scroll:{x:600}},A.default.createElement(z,{title:"\u65f6\u95f4",dataIndex:"createTime",key:"createTime",render:function(e,t){var a=t.createTime;return A.default.createElement("span",null,"\u5408\u8ba1"!==a?(0,C.default)(a).format("YYYY-MM-DD HH:mm"):"\u5408\u8ba1")}}),A.default.createElement(z,{title:"\u6536\u652f\u7c7b\u578b",dataIndex:"type",key:"type"}),A.default.createElement(z,{title:"\u8d26\u76ee\u7c7b\u578b",dataIndex:"value",key:"value"}),A.default.createElement(z,{title:"\u64cd\u4f5c\u4eba",dataIndex:"createName",key:"createName"}),A.default.createElement(z,{title:"\u91d1\u989d",dataIndex:"amount",key:"amount",render:function(e,t){var a=t.amount;return A.default.createElement("span",null,(0,T.Yuan)(a,2))}}),A.default.createElement(z,{title:"\u5907\u6ce8",dataIndex:"remark",key:"remark"}),A.default.createElement(z,{title:"\u64cd\u4f5c",dataIndex:"operating",key:"operating",render:function(t,a){var l=a.id;return A.default.createElement(d.default,{title:"\u662f\u5426\u5220\u9664\u652f\u51fa\u8d39\u7528\u6570\u636e",onConfirm:e.delete.bind(e,l),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},A.default.createElement("a",{href:"javascript:;"},0<l?"\u5220\u9664":""))}}))))))}}]),t}(A.PureComponent))||D)||D;t.default=Q}}]);