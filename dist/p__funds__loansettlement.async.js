(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{JmTs:function(e,t,a){"use strict";var l=a("TqRt"),n=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("P2fV");var d=l(a("NJEC"));a("Mwp2");var r=l(a("VXEj")),i=l(a("pVnL")),u=l(a("MVZn"));a("14J3");var c=l(a("BMrR"));a("Telt");var s=l(a("Tckk"));a("+L6B");var f=l(a("2/Rp"));a("jCWc");var o=l(a("kPKH"));a("miYZ");var p=l(a("tsqr")),m=l(a("lwsE")),h=l(a("W8MJ")),y=l(a("a1gu")),E=l(a("Nsbk")),v=l(a("7W2i"));a("5NDa");var g=l(a("5rEg"));a("2qtc");var I=l(a("kLXV"));a("IzEo");var b=l(a("bx4M"));a("FJo9");var k=l(a("L41K"));a("OaEy");var S=l(a("2fM7"));a("g9YV");var x=l(a("wCAj"));a("y8nQ");var D,w,A,C=l(a("Vl3Y")),L=n(a("q1tI")),O=l(a("wd/R")),N=a("MuoO"),F=l(a("usdK")),T=l(a("xLbA")),B=a("RO9D"),q=a("7cBs"),M=l(a("LtKH")),J=l(a("JU94")),j=l(a("QdJ6")),z=l(a("XoQv")),Y=C.default.Item,V=x.default.Column,G=S.default.Option,W=k.default.Step,P=b.default.Meta,Q=I.default.confirm,R=g.default.TextArea,H=(D=(0,N.connect)(function(e){var t=e.finance,a=e.loading;return{finance:t,loading:a.models.list}}),w=C.default.create(),D(A=w(A=function(e){function t(e){var a;return(0,m.default)(this,t),a=(0,y.default)(this,(0,E.default)(t).call(this,e)),a.settlement=function(){""!==a.state.supplierId&&""!==a.state.batchId?(0==a.state.totalSpending&&0==a.state.totalInComing&&p.default.info("\u662f\u5426\u4e0d\u5f55\u5165\u5176\u4ed6\u8d39\u7528!"),a.fetchAccount({suppliId:a.state.supplierId})):p.default.info("\u8d27\u4e3b\u8f66\u6b21\u4e0d\u53ef\u4e3a\u7a7a!")},a.handleOnQuery=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var l=t.supplierId,n=t.batchId;(0,B.isEmptyObject)(l)?p.default.warn("\u8bf7\u9009\u62e9\u8d27\u4e3b"):(0,B.isEmptyObject)(n)?p.default.warn("\u8bf7\u9009\u62e9\u8f66\u6b21"):(a.setState({supplierId:l,batchId:n,loading:!0}),a.fetchStatistical({supplierId:l,batchId:n}))}})},a.add=function(){a.fetchFinanceList({supplierId:a.state.supplierId,batchId:a.state.batchId}),a.setState({show:!0})},a.handleCancel=function(){a.setState({show:!1}),a.fetchStatistical({supplierId:a.state.supplierId,batchId:a.state.batchId})},a.modifyStatusBtn=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var l=t.name,n=t.type,d=t.amount,r=t.remark;(0,B.isEmptyObject)(l)?p.default.warn("\u8bf7\u9009\u62e9\u6536\u652f\u7c7b\u578b"):(0,B.isEmptyObject)(n)?p.default.warn("\u8bf7\u9009\u62e9\u8d26\u76ee\u7c7b\u578b"):(0,B.isEmptyObject)(d)?p.default.warn("\u8bf7\u8f93\u5165\u91d1\u989d"):d>1e7?p.default.error("\u91d1\u989d\u6570\u503c\u4e0d\u53ef\u5927\u4e8e999999.99!"):a.fetchFinanceEntry({type:l,value:n.split("|")[0],code:n.split("|")[1],amount:d,remark:r,supplierId:a.state.supplierId,batchId:a.state.batchId})}})},a.state={show:!1,supplierId:"",batchId:"",step:0,disabled:!0,totalSpending:0,totalInComing:0,loading:!1},a}return(0,v.default)(t,e),(0,h.default)(t,[{key:"componentDidMount",value:function(){this.fetchSupplierList({})}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"finance/clearData",payload:{}})}},{key:"getExtraContent",value:function(){var e=this.props.finance,t=e.supplierListData,a=e.batchSallOutListData,l=e.statisticalData,n=this.props.form.getFieldDecorator,d=t&&!Array.isArray(t)?t.suppliers:[],r=a||[],i=l&&!Array.isArray(l)?l:[],u=i.totalSpending,p=i.goodsPayment,m=i.totalInComing,h=i.totalGoodsAmount;h=h||"0",u=u||"0",p=p||"0",m=m||"0";var y={xs:24,sm:12,md:12,lg:12,xl:6,style:{marginBottom:12}};return L.default.createElement("div",{className:T.default.extraContent},L.default.createElement(C.default,{onSubmit:this.handleOnQuery,className:"login-form"},L.default.createElement(c.default,{gutter:24},L.default.createElement(o.default,y,L.default.createElement(Y,null,n("supplierId",{})(L.default.createElement(S.default,{placeholder:"\u8bf7\u9009\u62e9\u8d27\u4e3b",onChange:this.selectSupplier.bind(this),showSearch:!0,allowClear:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},d.map(function(e){return L.default.createElement(G,{key:e.user_id},e.name)}))))),L.default.createElement(o.default,y,L.default.createElement(Y,null,n("batchId",{})(L.default.createElement(S.default,{placeholder:"\u8bf7\u9009\u62e9\u8f66\u6b21\u4fe1\u606f",onChange:this.selectBatch.bind(this)},r.map(function(e){return L.default.createElement(S.default.Option,{key:e.id},e.carNo)}))))),L.default.createElement(o.default,{span:24,className:T.default.submitBtn},L.default.createElement(f.default,{type:"primary",htmlType:"submit",disabled:this.state.disabled},"\u67e5\u8be2"),L.default.createElement(f.default,{onClick:this.add,disabled:this.state.disabled,style:{width:160}},"\u8d27\u4e3b\u8d39\u7528\u652f\u51fa\u4e0e\u6536\u5165"),L.default.createElement(f.default,{onClick:this.settlement,disabled:this.state.disabled},"\u7ed3\u7b97")),L.default.createElement(o.default,{span:24},L.default.createElement(k.default,{current:this.state.step,className:T.default.step,style:{margin:"20px 0",display:"flex"}},L.default.createElement(W,{style:{flex:1,textAlign:"left"},title:"\u6b65\u9aa4\u4e00",description:"\u9009\u62e9\u9700\u8981\u7ed3\u7b97\u7684\u8f66\u6b21"}),L.default.createElement(W,{style:{flex:1,textAlign:"left"},title:"\u6b65\u9aa4\u4e8c",description:"\u5f55\u5165\u8f66\u6b21\u652f\u51fa\u8d39\u7528"}),L.default.createElement(W,{style:{flex:1,textAlign:"left"},title:"\u6b65\u9aa4\u4e09",description:"\u7ed3\u7b97\u5e76\u6253\u5370"}))),L.default.createElement(o.default,y,L.default.createElement(b.default,null,L.default.createElement(P,{avatar:L.default.createElement(s.default,{shape:"square",size:60,src:M.default}),title:"\u8d27\u6b3e\u91d1\u989d",description:h,style:{fontSize:20}}))),L.default.createElement(o.default,y,L.default.createElement(b.default,null,L.default.createElement(P,{avatar:L.default.createElement(s.default,{shape:"square",size:60,src:J.default}),title:"\u652f\u51fa\u5408\u8ba1",description:u,style:{fontSize:20}}))),L.default.createElement(o.default,y,L.default.createElement(b.default,null,L.default.createElement(P,{avatar:L.default.createElement(s.default,{shape:"square",size:60,src:j.default}),title:"\u6536\u5165\u5408\u8ba1",description:m,style:{fontSize:20}}))),L.default.createElement(o.default,y,L.default.createElement(b.default,null,L.default.createElement(P,{avatar:L.default.createElement(s.default,{shape:"square",size:60,src:z.default}),title:"\u5e94\u7ed3\u8d27\u6b3e",description:p,style:{fontSize:20}}))))))}},{key:"androidLogin",value:function(e){var t=this,a={accessToken:e,appType:"android"};this.props.dispatch({type:"login/bindAndroid",payload:(0,u.default)({},a)}).then(function(e){t.fetchSupplierList({})})}},{key:"fetchStatistical",value:function(e){var t=this;return this.props.dispatch({type:"finance/fetchStatistical",payload:e}).then(function(){var e=t.props.finance.statisticalData,a=e||[],l=a.totalSpending,n=a.totalInComing;t.setState({totalSpending:l,totalInComing:n,loading:!1})})}},{key:"fetchSupplierList",value:function(e){this.props.dispatch({type:"finance/fetchSupplierList",payload:e})}},{key:"fetchBatchSallOutList",value:function(e){this.props.dispatch({type:"finance/fetchBatchSallOutList",payload:e})}},{key:"fetchFinanceEntry",value:function(e){var t=this;this.props.dispatch({type:"finance/fetchFinanceEntry",payload:e}).then(function(){var e=t.props.finance.financeEntrylData.code;200===e?(p.default.info("\u65b0\u589e\u8d26\u76ee\u7c7b\u578b\u6210\u529f!"),t.fetchFinanceList({supplierId:t.state.supplierId,batchId:t.state.batchId}),t.setState({step:1})):p.default.info("\u65b0\u589e\u8d26\u76ee\u7c7b\u578b\u5931\u8d25!")})}},{key:"selectDicData",value:function(e){this.fetchDicData({name:e,dictType:"accountsAct"})}},{key:"fetchDicData",value:function(e){this.props.dispatch({type:"finance/fetchDicData",payload:e})}},{key:"fetchFinanceList",value:function(e){this.props.dispatch({type:"finance/fetchFinanceList",payload:e})}},{key:"fetchFinanceDelete",value:function(e){var t=this;this.props.dispatch({type:"finance/fetchFinanceDelete",payload:e}).then(function(){var e=t.props.finance.financeDeleteData.code;200===e?(p.default.info("\u5220\u9664\u6210\u529f!"),t.fetchFinanceList({supplierId:t.state.supplierId,batchId:t.state.batchId})):p.default.info("\u5220\u9664\u5931\u8d25!")})}},{key:"fetchSettmentGoods",value:function(e){var t=this;this.props.dispatch({type:"finance/fetchSettmentGoods",payload:e}).then(function(){var e=t.props.finance.settmentGoodsData,a=e.code,l=e.data;200===a?F.default.push("/funds/paymentbill?id=".concat(l)):p.default.error("\u7ed3\u7b97\u5931\u8d25")})}},{key:"fetchAccount",value:function(e){var t=this;this.props.dispatch({type:"finance/fetchAccount",payload:e}).then(function(){var e=t.props.finance.accountData,a=t;e?a.fetchSettmentGoods({supplierId:a.state.supplierId,batchId:a.state.batchId,accountId:e}):Q({title:"\u8be5\u8d27\u4e3b\u672a\u5f00\u901a\u7ed3\u7b97\u8d26\u6237\uff0c\u662f\u5426\u7ee7\u7eed\u7ed3\u7b97?",content:"",onOk:function(){a.fetchSettmentGoods({supplierId:a.state.supplierId,batchId:a.state.batchId})},onCancel:function(){return!1}})})}},{key:"selectSupplier",value:function(e){this.setState({supplierId:e}),this.fetchBatchSallOutList({supplierId:e,settlement:0})}},{key:"selectBatch",value:function(e){this.setState({batchId:e,disabled:!1})}},{key:"delete",value:function(e){this.fetchFinanceDelete({id:e})}},{key:"render",value:function(){var e=this,t=this.props.finance,a=t.statisticalData,l=t.dicData,n=t.financeListData,u=this.props.form.getFieldDecorator,s=this.getExtraContent(),p={pageSize:10},m=a&&!Array.isArray(a)?a:[],h=m.goodsVos;Array.isArray(h)||(h=[]);var y=Array.isArray(l)?l:[],E=[];if(n&&!Array.isArray(n)){var v=n.cxmBatchFinances,k=n.totalAmount,D={createTime:"\u5408\u8ba1",amount:k,id:-1},w=v.length;w&&JSON.stringify(v[w-1])!==JSON.stringify(D)&&v.push(D),E=v}var A={labelCol:{xs:{span:4},sm:{span:4}},wrapperCol:{xs:{span:20},sm:{span:20}}},N=L.default.createElement("div",null,L.default.createElement(C.default,{onSubmit:this.modifyStatusBtn,className:"login-form",style:{marginBottom:"12px",float:"left",width:"100%"}},L.default.createElement(c.default,{gutter:24},L.default.createElement(o.default,{span:12},L.default.createElement(Y,(0,i.default)({label:"\u6536\u652f\u7c7b\u578b"},A),u("name",{rules:[{required:!1,message:"\u8bf7\u9009\u62e9\u6536\u652f\u7c7b\u578b!"}]})(L.default.createElement(S.default,{placeholder:"\u8bf7\u9009\u62e9\u6536\u652f\u7c7b\u578b",style:{width:"100%"},onChange:this.selectDicData.bind(this)},L.default.createElement(G,{value:"\u6536\u5165"},"\u6536\u5165"),L.default.createElement(G,{value:"\u652f\u51fa"},"\u652f\u51fa"))))),L.default.createElement(o.default,{span:12},L.default.createElement(Y,(0,i.default)({label:"\u8d26\u76ee\u7c7b\u578b"},A),u("type",{rules:[{required:!1,message:"\u8bf7\u9009\u62e9\u8d26\u76ee\u7c7b\u578b!"}]})(L.default.createElement(S.default,{placeholder:"\u8bf7\u9009\u62e9\u8d26\u76ee\u7c7b\u578b",style:{width:"100%"}},y.map(function(e){return L.default.createElement(G,{key:"".concat(e.value,"|").concat(e.code)},e.value)})))))),L.default.createElement(c.default,{gutter:24},L.default.createElement(o.default,{span:12},L.default.createElement(Y,(0,i.default)({label:"\u91d1\u989d"},A),u("amount",{rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u91d1\u989d!"}]})(L.default.createElement(g.default,{placeholder:"\u8bf7\u8f93\u5165\u91d1\u989d"})))),L.default.createElement(o.default,{span:12},L.default.createElement(Y,(0,i.default)({label:"\u5907\u6ce8"},A),u("remark",{rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u5907\u6ce8!"}]})(L.default.createElement(R,{rows:2,placeholder:"\u8bf7\u8f93\u5165\u5907\u6ce8"}))))),L.default.createElement(c.default,{gutter:24},L.default.createElement(o.default,{span:24},L.default.createElement(f.default,null,"\u67e5\u8be2"),L.default.createElement(f.default,{type:"primary",htmlType:"submit"},"\u4fdd\u5b58")))));return L.default.createElement("div",null,L.default.createElement("div",{className:T.default.billDetails},L.default.createElement(b.default,{className:T.default.listCard,bordered:!1,title:"",extra:s},L.default.createElement(x.default,{dataSource:h,pagination:p,scroll:{x:800},bordered:!0,loading:this.state.loading},L.default.createElement(V,{title:"\u54c1\u79cd",dataIndex:"attrName",key:"attrName"}),L.default.createElement(V,{title:"\u9500\u552e\u8d27\u6b3e",dataIndex:"goodsAmount",key:"goodsAmount",render:function(e,t){var a=t.goodsAmount;return L.default.createElement("span",null,(0,q.Yuan)(a,2))}}),L.default.createElement(V,{title:"\u4ef6\u6570",dataIndex:"number",key:"number"}),L.default.createElement(V,{title:"\u91cd\u91cf",dataIndex:"weight",key:"weight"}),L.default.createElement(V,{title:"\u5e73\u5747\u552e\u4ef7",dataIndex:"averageAmount",key:"averageAmount",render:function(e,t){var a=t.averageAmount;return L.default.createElement("span",null,(0,q.Yuan)(a,2))}}),L.default.createElement(V,{title:"\u5e73\u5747\u91cd\u91cf",dataIndex:"averageWeight",key:"averageWeight"}))),L.default.createElement(b.default,{className:T.default.modalCard},L.default.createElement(I.default,{title:"\u8d27\u4e3b\u8d39\u7528\u652f\u51fa\u4e0e\u6536\u5165",visible:this.state.show,onCancel:this.handleCancel,destroyOnClose:"true",width:"1200px",className:T.default.modal,footer:[]},L.default.createElement(r.default,null,N),L.default.createElement(x.default,{dataSource:E,pagination:p,scroll:{x:600}},L.default.createElement(V,{title:"\u65f6\u95f4",dataIndex:"createTime",key:"createTime",render:function(e,t){var a=t.createTime;return L.default.createElement("span",null,"\u5408\u8ba1"!==a?(0,O.default)(a).format("YYYY-MM-DD HH:mm"):"\u5408\u8ba1")}}),L.default.createElement(V,{title:"\u6536\u652f\u7c7b\u578b",dataIndex:"type",key:"type"}),L.default.createElement(V,{title:"\u8d26\u76ee\u7c7b\u578b",dataIndex:"value",key:"value"}),L.default.createElement(V,{title:"\u64cd\u4f5c\u4eba",dataIndex:"createName",key:"createName"}),L.default.createElement(V,{title:"\u91d1\u989d",dataIndex:"amount",key:"amount",render:function(e,t){var a=t.amount;return L.default.createElement("span",null,(0,q.Yuan)(a,2))}}),L.default.createElement(V,{title:"\u5907\u6ce8",dataIndex:"remark",key:"remark"}),L.default.createElement(V,{title:"\u64cd\u4f5c",dataIndex:"operating",key:"operating",render:function(t,a){var l=a.id;return L.default.createElement(d.default,{title:"\u662f\u5426\u5220\u9664\u652f\u51fa\u8d39\u7528\u6570\u636e",onConfirm:e.delete.bind(e,l),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},L.default.createElement("a",{href:"javascript:;"},l>0?"\u5220\u9664":""))}}))))))}}]),t}(L.PureComponent))||A)||A),K=H;t.default=K}}]);